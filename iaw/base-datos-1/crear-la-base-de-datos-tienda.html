<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>crear-la-base-de-datos-tienda</title>
	<style>
		/* Basic styles for readability */
		body {
			font-family: sans-serif;
			max-width: 800px;
			margin: 2em auto;
			padding: 0 1em;
			line-height: 1.6;
		}
		img { max-width: 100%; height: auto; }
		pre { background-color: #f4f4f4; padding: 1em; overflow-x: auto; }
		code { font-family: monospace; }
	</style>
</head>
<body>
	<h1>Base de datos de prueba</h1>
<p>Vamos a crear una base de datos de prueba que se llama <code>tienda</code> que utilizaremos para nuestros ejercicios</p>
<p>Crea un fichero que se llama <code>bd-pruebas-php.sql</code> con este contenido. Lo que se define en ese fichero es:</p>
<ol>
<li>Se crea un usuario que se llama <code>usuario</code> y se le pone de contraseña <code>usuario</code>.</li>
<li>Se crea la base de datos <code>tienda</code> y se le insertan datos de prueba.</li>
<li>Se le dan todos los permisos al usuario <code>usuario</code> sobre la futura base de datos <code>tienda</code></li>
</ol>
<pre><code class="language-sql">-- Creamos el usuario &quot;usuario&quot; con la contraseña &quot;usuario&quot;.
CREATE USER 'usuario'@'localhost' IDENTIFIED BY 'usuario';

-- Creamos la base de datos tienda y sus tablas
CREATE DATABASE IF NOT EXISTS tienda;
USE tienda;

-- Tabla 1: Clientes
CREATE TABLE clientes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    correo VARCHAR(100) UNIQUE,
    fecha_registro DATE DEFAULT CURRENT_DATE
);

-- Tabla 2: Pedidos (uno-a-muchos con clientes)
CREATE TABLE pedidos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT NOT NULL,
    fecha_pedido DATE DEFAULT CURRENT_DATE,
    estado ENUM('pendiente', 'enviado', 'entregado', 'cancelado') DEFAULT 'pendiente',
    FOREIGN KEY (cliente_id) REFERENCES clientes(id)
);

-- Tabla 3: Productos
CREATE TABLE productos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    precio DECIMAL(10,2) NOT NULL,
    stock INT DEFAULT 0
);

-- Tabla 4: Relación muchos-a-muchos entre pedidos y productos
CREATE TABLE pedido_producto (
    pedido_id INT NOT NULL,
    producto_id INT NOT NULL,
    cantidad INT DEFAULT 1,
    PRIMARY KEY (pedido_id, producto_id),
    FOREIGN KEY (pedido_id) REFERENCES pedidos(id) ON DELETE CASCADE,
    FOREIGN KEY (producto_id) REFERENCES productos(id) ON DELETE CASCADE
);

-- Insertar clientes
INSERT INTO clientes (nombre, correo) VALUES
('Ana Torres', 'ana@example.com'),
('Luis Pérez', 'luis@example.com');

-- Insertar productos
INSERT INTO productos (nombre, precio, stock) VALUES
('Teclado mecánico', 45.99, 20),
('Ratón inalámbrico', 25.50, 35),
('Monitor 24&quot;', 150.00, 10);

-- Insertar pedidos
INSERT INTO pedidos (cliente_id, fecha_pedido, estado) VALUES
(1, '2025-11-15', 'enviado'),
(2, '2025-11-16', 'pendiente');

-- Insertar relación pedido-producto
INSERT INTO pedido_producto (pedido_id, producto_id, cantidad) VALUES
(1, 1, 2),  -- Pedido 1: 2 teclados
(1, 2, 1),  -- Pedido 1: 1 ratón
(2, 3, 1);  -- Pedido 2: 1 monitor

-- Finalmente le damos permisos al usuario `usuario` sobre esta base de datos recién creada.
GRANT ALL PRIVILEGES ON `tienda`.* TO 'usuario'@'localhost';

-- Guardamos los cambios realizados
FLUSH PRIVILEGES;
</code></pre>
<p>Y ahora ya solos nos queda ejecutar lo siguiente:</p>
<pre><code class="language-bash">mysql -u root -p &lt; bd-pruebas-php.sql
</code></pre>

</body>
</html>